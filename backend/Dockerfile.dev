FROM golang:1.22-alpine

WORKDIR /app

# Install build dependencies
RUN apk add --no-cache git ffmpeg

# Install air for hot reload (using compatible version for Go 1.22)
RUN go install github.com/cosmtrek/air@v1.49.0

# Copy go mod files
COPY go.mod ./
COPY go.sum* ./
RUN go mod download

# Copy air config if exists
COPY .air.toml* ./

# Expose port
EXPOSE 8080

# Create directories for storage
RUN mkdir -p /var/lib/cashbacktv/streams /var/lib/cashbacktv/logos /var/lib/cashbacktv/uploads

# Run air for hot reload (will use default config if .air.toml doesn't exist)
CMD ["air"]

